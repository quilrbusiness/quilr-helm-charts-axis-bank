
001. clickhouse-db-deployment
002. svc type patch for internal-lb and check accessibility with port 8123 on ui
003. verify table creation on ui under defaullt database (which were created as a part of init scripts while clickhouse installation)
004. vault secret insertion for clickhouse db creds and verification through cli
005. creation of new common fileshare under /media/secopsquilrstgfileshare
006. update postgres scripts ddl and dml in quilr and quilr_auth db
007. git clone -b sentara-paas-deployment https://ameenquilr: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@github.com/quilrbusiness/quilr-helm-charts.git
008. upgrade and restart for common-config and other related services.
009. verify the changes in quilr-web and data-explorer-service and browser-extension-service for common fileshare mount
010. validate the changes in ui
011. sync the content-management-changes




export VAULT_TOKEN=$(kubectl get secrets vault-unseal-keys --namespace=quilr -o jsonpath={.data.vault-root} | base64 --decode)
export VAULT_SKIP_VERIFY=true
export VAULT_ADDR="https://10.8.133.8:8200"

vault kv get secret/quilr-common-config-vault 




#cd content-management-service
#git clone -b main  https://ameenquilr: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@github.com/quilrbusiness/content-management-service.git
#cd static-files
#rsync -a --delete --itemize-changes --stats ./ /media/secopsquilrstgfileshare/

# Clone contenat management and Helm charts


cd content-management-service
git remote set-url origin https://ameenquilr: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@github.com/quilrbusiness/content-management-service.git
git pull
cd static-files
rsync -a --delete --itemize-changes --stats ./ /media/secopsquilrstgfileshare/
mkdir -p /media/secopsquilrstgfileshare/quilr-data-upload

# Clone Helm charts

cd quilr-helm-charts
git remote set-url origin https://ameenquilr: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@github.com/quilrbusiness/quilr-helm-charts.git
git pull

./helm-upgrade-restart.sh quilr-common-config quilr-ai-config-manager

#sync of content management: ( CAN BE RUN AS A SCRIPT )

#!/usr/bin/env bash
set -e

cd content-management-service
git remote set-url origin https://ameenquilr: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@github.com/quilrbusiness/content-management-service.git
git pull 
cd static-files
#rsync -a --delete --itemize-changes --stats ./ /media/secopsquilrstgfileshare/

for dir in   browser-extension-service   content-lambda-service   dashboard-service   data-explorer-service   quilr-grouping-service   snowflake-ingestion-service   classification-config-service   content-repository-service   data-config-api   data-fabric-core-service   quilr-playbook-service   templating-engine  templating-engine-sentara; do   echo ">>> Syncing $dir ...";   sudo rsync -a --delete --itemize-changes --stats     ./"$dir"/ /media/secopsquilrstgfileshare/"$dir"/; done 
echo "Content Management Sync Completed"



# Deploy Click House and execute all commands 
# Request to open port number 8123 on UI for clickhouse svc
#   http://<LB IP Address>:8123/
#   username: quilradmin
#   password: "QU1lr$F345#we"
cd ~/quilr-helm-charts/dependencies/clickhouse
cat script

# Execute Postgress updates and execute all scritps mentioned in init-scripts-update-ddl-23092025-quilr-db and init-scripts-update-dml-23092025-quilr-db
cd ~/quilr-helm-charts/dependencies/postgres/
ls -lrt init-scripts-update-dml-23092025-quilr-db
ls -lrt init-scripts-update-ddl-23092025-quilr-db
#-------------------------------------------------------------------------------------------------------
#

#-------------------------------------------------------------------------------------------------------

# Deploy Quilr Services

./helm-upgrade-restart.sh axis-analytics-job axis-ingestion-service quilr-query-builder quilr-ai-config-manager
kubectl get pods -A -l 'app in (axis-analytics-job,axis-ingestion-service,quilr-query-builder,quilr-ai-config-manager)'

./helm-upgrade-restart.sh quilr-bff app-sync-client-service quilr-auth-ts data-explorer-service browser-extension-service quilr-web classification-config-service

kubectl get pods -A -l 'app in (quilr-bff,app-sync-client-service,quilr-auth-ts,data-explorer-service,browser-extension-service,quilr-web,classification-config-service)'


# Execute Postgress updates and execute

update classificationrelease set published=FALSE;




Agent Deployment:

https://quilr-extensions.s3.ap-south-1.amazonaws.com/browser-agent/prod/windows/windows.zip

